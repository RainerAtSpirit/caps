/*! caps 0.6.1 
* Copyright (c) 1998, 2014 Spirit EDV-Beratung AG 
* Available via the MIT license.
* see: https://github.com/RainerAtSpirit/caps for details.
*/
!function(a,b){"function"==typeof define&&define.amd?define(b):a.caps=b()}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("almond",function(){}),c("common",[],function(){function a(){for(var a=Array.prototype.slice.call(arguments),b=a.shift(),c=0;c<a.length;c++){if(!b.hasOwnProperty(a[c]))return!1;b=b[a[c]]}return!0}function b(a,b){return b="object"==typeof b?b:Array.prototype.slice.call(arguments,1),a.replace(/\{\{|\}\}|\{(\w+)\}/g,function(a,c){return"{{"===a?"{":"}}"===a?"}":b[c]})}function c(a){var b="/_layouts/CorasWorksApps/CorasWorksApplicationService.ashx",c=a.url||b,d={data:null,dataType:"json"};return a.url&&delete a.url,$.ajax(c,$.extend(!0,d,a))}return{checkNested:a,getPromise:c,format:b}}),c("batchRequest/index",["require"],function(){function a(){}return a}),c("processBatchData/createBatchXML",["require","jquery","common"],function(a){var b,c,d=a("jquery"),e=a("common");return b=function(){this.methods=""},c={create:function(a){var b,c=d.isArray(a)?a:[a],e=this,f=c.length;for(e.methods='<Batch><ows:Batch OnError="Continue"  xmlns:ows="http://www.corasworks.net/2012/ows">',b=0;f>b;b++)e.processList(c[b]);return e.methods+="</ows:Batch></Batch>",e.methods},processList:function(a){var b,c=this,e=d.isArray(a.batch)?a.batch:[a.batch],f=e.length;for(b=0;f>b;b++)c.processItems(a.name,e[b])},processItems:function(a,b){var c,e=this,f=d.isArray(b.items)?b.items:[b.items],g=f.length,h={create:"New",update:"Update","delete":"Delete"};for(c=0;g>c;c++){var i=f[c];e.methods+=this.format('<Method ID="{methodId}"><SetList>%{list}%</SetList><SetVar Name="Cmd">{cmd}</SetVar>',{methodId:(i.Id?i.Id+","+h[b.method]:h[b.method])+","+a,list:a,cmd:"delete"===b.method?"Delete":"Save"}),e.processProps(i),e.methods+="</Method>"}},processProps:function(a){var b,c=this;c.methods+=this.format('<SetVar Name="ID">{itemId}</SetVar>',{itemId:a.Id||"New"});for(b in a)a.hasOwnProperty(b)&&"Id"!==b&&(c.methods+=this.format('<SetVar Name="urn:schemas-microsoft-com:office:office#{0}"><![CDATA[{1}]]></SetVar>',b,a[b]))}},d.extend(!0,b.prototype,e,c),new b}),c("processBatchData/index",["require","jquery","./createBatchXML"],function(a){function b(a,b){var h,i,j,k;return a=c(a),h=d(a),j=g.create(a),i=f.map(a,function(a){return a.name}).join(","),k=f.extend(!0,e,b,{data:{SiteUrl:h,ListTitle:i,Batch:j}}),this.getPromise(k)}function c(a){return f.isArray(a)?a:[a]}function d(a){var b=h?h:"",c=a[0].site?a[0].site:b,d=c.replace(/^\/+|\/+$/g,"");if(!d)throw new Error("caps.processBatchData(). Missing required site property and fallback method L_Menu_BaseUrl is undefined.");return"%WebRoot%"+c}var e,f=a("jquery"),g=a("./createBatchXML"),h=window.L_Menu_BaseUrl||null;return e={type:"POST",data:{RequestType:"ProcessBatchData",OutputType:"json"}},b}),c("polyfills",[],function(){Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(null==this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;for(b=e,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),c=b>=0?Math.min(b,e-1):e-Math.abs(b);c>=0;c--)if(c in d&&d[c]===a)return c;return-1})}),c("getListItems/convertFilter2Caml",["require","jquery","common"],function(a){function b(a){function b(a,e){var i,j="",k=a.filters,m=f[a.logic||"And"];i="undefined"!=typeof e?parseInt(e.substring(e.lastIndexOf(".")+1),10):0,i>0&&i%2===0&&(l.unshift(l[0]),l.push(l[0].replace("<","</"))),l.push(d.format("<{0}>","undefined"!=typeof e?g[m]:m)),c.each(k,function(a,c){if(j=e?e+"."+a.toString():a.toString(),"undefined"!=typeof c.logic)b(c,j);else{if(a>1){var f=l.lastIndexOf("<"+g[m]+">")+1;-1===f?l.unshift(d.format("<{0}>",m)):l.splice(f,0,d.format("<{0}>",m)),l.push(d.format("</{0}>",m))}l.push(h(c))}}),l.push(d.format("</{0}>",m))}function h(a){a=c.isArray(a)?a[0]:a;var b="<{0}><FieldRef Name='{1}' /><Value Type='{2}'>{3}</Value></{0}>",f=a.value,g=e[a.operator],h=a.field,i=j[a.field].type;return d.format(b,g,h,i,f)}a=a||{};var i=[],j=a.fields,k=a.filter,l=[];return i.push("<Where>"),k&&1===k.filters.length&&k.filters[0].field?i.push(h(k.filters[0])):(b(a.filter),i.push(l.join(""))),i.push("</Where>"),i.join("")}var c=a("jquery"),d=a("common"),e={eq:"Eq",neq:"Neq",lt:"Lt",lte:"Leq",gt:"Gt",gte:"Geq",startswith:"BeginsWith",contains:"Contains"},f={and:"And",or:"Or",And:"And",Or:"Or"},g={Or:'Or Group="true"',And:'And Group="true"'};return b}),c("getListItems/index",["require","jquery","common","./convertFilter2Caml"],function(a){function b(a,b){var j,k;return a=c(a),j={SiteUrl:d(a),ListTitle:e(a)},a.caml&&(j.CAML=f(a)),k=h.extend(!0,g,b,{data:j}),i.getPromise(k)}function c(a){return a||{}}function d(a){var b=k?k:"",c=a.siteUrl?a.siteUrl:b,d=c.replace(/^\/+|\/+$/g,"");if(!d)throw new Error("caps.getListItems(). Missing required site property and fallback method L_Menu_BaseUrl is undefined.");return"%WebRoot%/"+d}function e(a){if(!a.listTitle)throw new Error("caps.getListItems(). Missing required title property");return a.listTitle}function f(a){function b(a){var b=[];return a.sort=h.isArray(a.sort)?a.sort:[a.sort],b.push("<OrderBy>"),h.each(a.sort,function(a,c){e="asc"===c.dir,b.push(i.format('<FieldRef Name="{0}" Ascending="{1}"/>',c.field,e))}),b.push("</OrderBy>"),b.join("")}function c(){var a=[];return a.push("<QueryOptions>"),a.push("<DateInUtc>True</DateInUtc>"),a.push("<ExpandUserField>True</ExpandUserField>"),a.push("</QueryOptions>"),a.join("")}var d=[],e=!0,f=a.caml;if(f.filter&&!i.checkNested(a.model.fields))throw new Error("caps.getListItems({caml.filter: obj}). Missing required model.fields property.");if(d.push("<Query>"),f.sort&&d.push(b(f)),f.filter){var g={filter:f.filter,fields:a.model.fields};d.push(j(g))}return d.push("</Query>"),d.push(c(f)),d.join("")}var g,h=a("jquery"),i=a("common"),j=a("./convertFilter2Caml"),k=window.L_Menu_BaseUrl||null;return g={type:"GET",data:{RequestType:"GetListItems",OutputType:"json"}},b}),c("getListInfo/index",["require","jquery"],function(a){function b(a,b){var h,i,j;return a=c(a),h=d(a),i=e(a),j=g.extend(!0,f,b,{data:{SiteUrl:h,ListTitle:i}}),this.getPromise(j)}function c(a){return a||{}}function d(a){var b=h?h:"",c=a.SiteUrl?a.SiteUrl:b,d=c.replace(/^\/+|\/+$/g,"");if(!d)throw new Error('caps.getListInfo(). Missing required "siteUrl" property and fallback method L_Menu_BaseUrl is undefined.');return"%WebRoot%/"+d}function e(a){return a.listTitle?a.listTitle:""}var f,g=a("jquery"),h=window.L_Menu_BaseUrl||null;return f={type:"GET",data:{RequestType:"GetListInfo",OutputType:"json"}},b}),c("caps",["require","common","batchRequest/index","processBatchData/index","polyfills","getListItems/index","getListInfo/index","processBatchData/createBatchXML","getListItems/convertFilter2Caml"],function(a){var b,c,d,e="0.6.1",f=a("common"),g=a("batchRequest/index"),h=a("processBatchData/index");return a("polyfills"),b=function(){this.version=e,this.batchRequest=g,this.processBatchData=h,this.getListItems=a("getListItems/index"),this.getListInfo=a("getListInfo/index")},c={ProcessBatchData:h,BatchRequest:g},d={fn:{createBatchXML:function(b){var c=a("processBatchData/createBatchXML");return c.create(b)},convertFilter2Caml:a("getListItems/convertFilter2Caml")}},$.extend(!0,b.prototype,f,d,c),new b}),c("jquery",function(){return $}),b("caps")});