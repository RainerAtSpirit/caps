/*! caps 2013-10-01 
* Copyright (c) 1998 - 2013 Rainer Wittmann, Spirit EDV-Beratung AG 
*/
(function(){var a=this,b=a.caps,c=a.caps={};c.VERSION="0.1.0";var d="/_layouts/CorasWorksApps/CorasWorksApplicationService.ashx";c.noConflict=function(){return a.caps=b,this};var e=c.settings={url:d,cache:!0,dataType:"json",type:"POST"},f=c.fn={checkNested:function(a){for(var b=Array.prototype.slice.call(arguments),a=b.shift(),c=0;c<b.length;c++){if(!a.hasOwnProperty(b[c]))return!1;a=a[b[c]]}return!0},format:function(a,b){return b="object"==typeof b?b:Array.prototype.slice.call(arguments,1),a.replace(/\{\{|\}\}|\{(\w+)\}/g,function(a,c){return"{{"==a?"{":"}}"==a?"}":b[c]})}};c.createBatchMethod=function(a){var b=function(a){return a=$.isArray(a)?a:[a],this.methods="",this.processOptions(a)};return $.extend(b.prototype,{processOptions:function(a){var b=this;b.methods='<Batch><ows:Batch OnError="Continue"  xmlns:ows="http://www.corasworks.net/2012/ows">',$.each(a,function(a,c){b.processList(c)}),b.methods+="</ows:Batch></Batch>"},processList:function(a){var b=this,c=$.isArray(a.batch)?a.batch:[a.batch];$.each(c,function(c,d){b.processItems(a.name,d)})},processItems:function(a,b){var c=this,d=$.isArray(b.items)?b.items:[b.items],e={create:"New",update:"Update","delete":"Delete"};$.each(d,function(d,g){c.methods+=f.format('<Method ID="{methodId}"><SetList>%{list}%</SetList><SetVar Name="Cmd">{cmd}</SetVar>',{methodId:(g.Id?g.Id+","+e[b.method]:e[b.method])+","+a,list:a,cmd:"delete"===b?"Delete":"Save"}),c.processProps(g),c.methods+="</Method>"})},processProps:function(a){var b=this;b.methods+=f.format('<SetVar Name="ID">{itemId}</SetVar>',{itemId:a.Id||"New"}),$.each(a,function(a,c){"Id"!==a&&(b.methods+=f.format('<SetVar Name="urn:schemas-microsoft-com:office:office#{0}"><![CDATA[{1}]]></SetVar>',a,c))})}}),new b(a).methods},c.processBatchData=function(a,b){a=$.isArray(a)?a:[a];var c=$.extend(!0,{},e,{data:{RequestType:"ProcessBatchData",SiteUrl:"%WebRoot%/"+a[0].site,ListTitle:$.map(a,function(a){return a.name}).join(","),OutputType:"json",Batch:this.createBatchMethod(a)}},b);return $.ajax(c)}}).call(this);